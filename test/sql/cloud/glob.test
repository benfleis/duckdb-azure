# name: test/sql/cloud/glob.test
# group: [cloud]

require azure

require-env AZURE_STORAGE_ACCOUNT

require-env AZ_DATA_DIR

require-env AZURE_AUTH_ENV 1

statement ok
CREATE SECRET az1 (
    TYPE AZURE,
    PROVIDER CREDENTIAL_CHAIN,
    ACCOUNT_NAME '${AZURE_STORAGE_ACCOUNT}'
);


# Auto glob: "foo" -> "foo/**/*.csv" if foo doesn't exist via MF reader 
query II
SELECT l_shipmode, COUNT(*) FROM read_csv('az://${AZ_DATA_DIR}/partitioned') GROUP BY l_shipmode ORDER BY l_shipmode;
----
AIR	2318
SHIP	2301
TRUCK	2317

# SHOULD: Auto glob: "foo" -> "foo/**/*.csv" if foo doesn't exist
# FAILS: Currently fails because glob support is limited and doesn't support this expr.
# statement error
# SELECT l_shipmode, COUNT(*) FROM read_csv('abfss://${AZ_DATA_DIR}/partitioned') GROUP BY l_shipmode ORDER BY l_shipmode;
# ----
# Not implemented Error: abfss do not manage recursive lookup patterns
